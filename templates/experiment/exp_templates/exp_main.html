{% extends "base.html" %}

{% load static %}
{% load render_table from django_tables2 %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<script src="{% static 'apps/experiment/js/experiment.js' %}"></script>
<script src="{% static 'hitsDB/js/multiform.js' %}"></script>
<link rel="stylesheet" href="{% static 'apps/experiment/css/exp_main.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'hitsDB/css/jquery.datetimepicker.min.css' %}">
<script src="{% static 'hitsDB/js/jquery.datetimepicker.full.min.js' %}"></script>

<div id="exp-container" class="container-fluid multiform">
    <div class="row justify-content-center">

        <div class="col-2">
            <div id="exp-info" class="jumbotron">
                <h3> {{ exp.name }}</h3>
                <p> Created: {{ exp.dateTime }}</p>
                <form id="exp-form" method="post">{% csrf_token %}
                    {% include 'bs4_form.html' with form=forms.expform %}
                    {% comment %} {{ forms.expform|crispy}} {% endcomment %}
                    <button type="submit" class="btn btn-primary">Save</button>
                    <a id='delete-exp' class='btn btn-danger' role='button' href="{% url 'delete_exp' exp.pk %}"> Delete
                    </a>
                </form>

            </div>


        </div>

        <div class="col-8">
            <div class="row">
                <div class="col-2">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active" id="v-pills-step1-tab" data-toggle="pill" href="#v-pills-step1"
                            role="tab" aria-controls="v-pills-step1" aria-selected="true">1) Initialization</a>
                        <a class="nav-link" id="v-pills-step2-tab" data-toggle="pill" href="#v-pills-step2" role="tab"
                            aria-controls="v-pills-step2" aria-selected="false">2) Source</a>
                        <a class="nav-link" id="v-pills-step3-tab" data-toggle="pill" href="#v-pills-step3" role="tab"
                            aria-controls="v-pills-step3" aria-selected="false">3) Destination</a>
                        <a class="nav-link" id="v-pills-step4-tab" data-toggle="pill" href="#v-pills-step4" role="tab"
                            aria-controls="v-pills-step4" aria-selected="false">4) Soaks </a>
                    </div>
                </div>

                <div class="tab-content" id="v-pills-tabContent">
                    <div class="tab-pane fade show active" id="v-pills-step1" role="tabpanel"
                        aria-labelledby="v-pills-step1-tab">
                        <div class="row">
                            <div class="col">
                                <div class="jumbotron">
                                    <h3> Instructions </h3>
                                    <ul>
                                        <li> Upload the .json file output from running the PreGUI script ().</li>
                                        <li> See example file: </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            {% if current_step > 0 %}
                            <div class="col">
                                <div class="jumbotron">
                                    <h3>RockImager JSON</h3>
                                    <form id="init-form" enctype="multipart/form-data" method="post">{% csrf_token %}
                                        {{ forms.initform|crispy }}
                                        <button type="submit" class="btn btn-primary">Upload</button>
                                    </form>

                                </div>
                            </div>

                            {% if exp.initData %}
                            <div class="col">
                                <div class="jumbotron">
                                    <h3>Processed JSON</h3>
                                    {% if initData_local_url %}
                                    <p> Local uploaded file: <a href={{initData_local_url}}> {{initData_local}} </a>
                                    </p>
                                    {% endif %}

                                    {% if init_data_file_url %}
                                    <p> s3 uploaded file: <a href={{init_data_file_url}}> {{init_data_file_url}} </a>
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            {% else %}
                            <span> Experiment missing source or destination plate type. </span>
                            {% endif %}

                        </div>

                    </div>
                    <div class="tab-pane fade" id="v-pills-step2" role="tabpanel" aria-labelledby="v-pills-step2-tab">
                        <div class="row">
                            <div class="col">
                                <div class="jumbotron">
                                    <h3> Instructions </h3>
                                    <ul>
                                        <li> yada yada.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div class="jumbotron">
                                    <h3>Upload drop images</h3>
                                    {% if current_step > 1 %}
                                    {% render_table dest_plates_table %}

                                    {% comment %} <form id="plates-form" method="post">{% csrf_token %}
                                        {{ forms.platesform|crispy}}
                                        <button type="submit" class="btn btn-primary">Generate plates</button>
                                        {% if platesValid %}
                                        <a role="button" class="btn btn-primary" href="{% url 'exp_plates' exp.pk %}">View
                                            plates</a>
                                        {% endif %}
                                    </form> {% endcomment %}
                                    {% else %}
                                    <p> Please complete Step 1).</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="tab-pane fade" id="v-pills-step3" role="tabpanel" aria-labelledby="v-pills-step3-tab">
                        <div class="row">
                            <div class="col">
                                <div class="jumbotron">
                                    <h3> Instructions </h3>
                                    <ul>
                                        <li> yada yada.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class='row'>
                            <div class="col">
                                <div class="jumbotron">
                                    <h3>Source plates setup</h3>
                                    {% if current_step > 2 %}
                                    <form id="platelib-form" enctype="multipart/form-data" method="post">
                                        {% csrf_token %}
                                        {{ forms.platelibform|crispy}}
                                        <span>
                                            <button type="submit" class="btn btn-primary">Submit</button>

                                        </span>
                                    </form>
                                    {% else %}
                                    <p> Please complete Step 2).</p>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="col">
                                <div class="jumbotron">
                                    <h3>Source plates table</h3>
                                    {% render_table src_plates_table %}
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="tab-pane fade" id="v-pills-step4" role="tabpanel" aria-labelledby="v-pills-step4-tab">
                        <div class="row">
                            <div class="col">
                                <div class="jumbotron">
                                    <h3> Instructions </h3>
                                    <ul>
                                        <li> yada yada.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div class="jumbotron">
                                    <h3>Soak setup</h3>
                                    {% if current_step > 2 %}
                                    <form id="soaks-form" method="post">{% csrf_token %}
                                        {{ forms.soaksform|crispy}}
                                        <span>
                                            <button type="submit" class="btn btn-primary">Generate soaks</button>
                                            {% comment %} {% if soaksValid %}
                                            <a role="button" class="btn btn-primary"
                                                href="{% url 'exp_soaks' exp.project.pk exp.pk %}">View
                                                soaks</a>
                                            {% endif %} {% endcomment %}
                                        </span>
                                    </form>
                                    {% else %}
                                    <p> Please complete Step 2).</p>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col">
                                    {% if soaksValid %}
                                    <div class="jumbotron">
                                        <h3>Soaks Download</h3>                   
                                        <a role="button" class="btn btn-secondary" href="{{soaks_download}}"> Download </a>
                                    </div>
                                    {% endif %}
                                </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>

<script>
    $(document).ready(function () {
        lib_pk = "{{exp.library.pk|safe}}";
        confirmLibraryChange(lib_pk);
        initCurrentStep('{{current_step}}');
    });
</script>

<script>
  $(function () {
    $("#id_soakDate").datetimepicker({
      format: 'd/m/Y H:i',
    });
  });
</script>
{% endblock content %}