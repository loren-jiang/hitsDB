{% extends "base.html" %}

{% load static %}
{% load render_table from django_tables2 %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<script src="{% static 'apps/experiment/js/experiment.js' %}"></script>
<script src="{% static 'hitsDB/js/multiform.js' %}"></script>

<div id="exp-container" class="container multiform">
    <div class="row">

        <div class="col-3">
        <div id="exp-info" class="jumbotron">
            <h3> {{ exp.name }}</h3>
            <p> Created: {{ exp.dateTime }}</p>
            <p> Protein: {{ exp.protein }}</p>
            <p> Description: {{ exp.description }}</p>
            <p> Library: 
                {% if exp.library %}
                <a href="{% url 'lib' exp.library.id %}">{{ exp.library }}</a> 
                {% endif %}
            </p> 
            <a id='delete-exp' class='btn btn-danger' role='button' href="{% url 'delete_exp' exp.pk %}"> Delete experiment </a> 
        </div>

        <div id="exp-plates">
            {% render_table src_plates_table %}
            {% render_table dest_plates_table %}
        </div>  
        </div>

        <div class="col-9">
            <div class="row">
                <div class="col-6">
                    <div class="jumbotron">
                        <h3>Step 1: Experiment setup</h3>
                        <form id="exp-form" method="post">{% csrf_token %}
                            {{ forms.expform|crispy}}
                            <button type="submit" class="btn btn-info">Save</button>                            
                        </form>
                    </div>
                </div>
                <div class="col-6">
                    <div class="jumbotron">
                        <h3>Step 2: Plate setup</h3>
                        {% if current_step > 1 %}
                        <form id="plates-form" method="post">{% csrf_token %}
                            {{ forms.platesform|crispy}}
                            <button type="submit" class="btn btn-info">Generate plates</button>
                            {% if plates_valid %}
                            <a role="button" class="btn btn-info" href="{% url 'exp_plates' exp.pk %}">View plates</a>
                            {% endif %}
                        </form>
                        {% else %}
                        <p> Please select library in Step 1.</p>
                        {% endif %}
                    </div>
                </div> 

                <div class="col-6">
                    <div class="jumbotron">
                        <h3>Step 3: Soak setup</h3>
                        {% if current_step > 2 %}
                        <form id="soaks-form" method="post">{% csrf_token %}
                            {{ forms.soaksform|crispy}}
                            <span>
                                <button type="submit" class="btn btn-info">Generate soaks</button>
                                {% if soaks_valid %}
                                <a role="button" class="btn btn-info" href="{% url 'exp_soaks' exp.pk %}">View soaks</a>
                                {% endif %}
                            </span>
                            
                        </form> 
                        {% else %}
                        <p> Please complete Step 2.</p>
                        {% endif %}
                    </div>
                </div>
                <div class="col-6">
                    <div class="jumbotron">
                        <h3>Step 4: Plate setup</h3>
                        {% if current_step > 3 %}
                        <p>soaks!</p>
                        {% else %}
                        <p> Please complete Step 1.</p>
                        {% endif %}
                    </div>
                </div> 
            </div>
            
        </div>

    </div>
</div>
  
<script>
$(document).ready(function() {
    lib_pk = "{{exp.library.pk|safe}}";
    confirmLibraryChange(lib_pk);
});
</script>
{% endblock content %}